{% extends "base.html" %}

{% load humanize %}
{% load static %}

{% block breadcrumb %}
  {% trans "Cartes" as menu %}
  {% include "partials/breadcrumb.html" with menu=menu %}
{% endblock breadcrumb %}
{% partialdef card_answer %}
<div id="flashcard-{{ flashcard.id }}"
     hx-get="{% url 'flashcards:show_question' flashcard.pk %}"
     hx-target="this"
     hx-swap="outerHTML "
     class="flex flex-col justify-center p-4 text-white bg-teal-700 rounded-md border shadow-sm cursor-pointer md:p-5 dark:border-teal-900">
  <p>{{ flashcard.answer_display }}</p>
</div>
{% endpartialdef card_answer %}
{% block modal %}
  <dialog data-modal class="bg-white rounded-xl shadow-lg dark:bg-gray-800">
    <div class="p-4 text-center sm:p-10 sm:py-6">
      <h3 class="mb-2 text-2xl font-bold text-gray-800 dark:text-gray-200">{% trans "Email du destinataire" %}</h3>
      <form hx-target="dialog"
            hx-include="[id='filter-form']"
            id="dialog-form"
            hx-post="{% url 'gifts:set_recipient' %}">
      </form>
    </div>
    <div class="flex items-center">
      <button data-modal-close
              type="button"
              class="inline-flex gap-2 justify-center items-center p-4 w-full text-sm font-semibold text-gray-800 bg-gray-100 rounded-bl-xl border border-transparent ring-offset-white transition-all dark:text-white dark:bg-gray-700 hover:text-blue-600 focus:ring-2 focus:ring-gray-100 focus:ring-offset-2 focus:outline-none dark:hover:bg-gray-600 dark:focus:ring-gray-600 dark:focus:ring-offset-gray-800"
              data-hs-overlay="#hs-cookies">{% trans "Annuler" %}</button>
      <button type="submit"
              form="dialog-form"
              class="inline-flex gap-2 justify-center items-center p-4 w-full text-sm font-semibold text-white bg-blue-500 rounded-br-xl border border-transparent transition-all hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none dark:focus:ring-offset-gray-800"
              data-hs-overlay="#hs-cookies">{% trans "Soumettre" %}</button>
    </div>
  </dialog>
{% endblock modal %}
{% block javascript %}
  <script src="{% static 'javascript/modal.js' %}"></script>
{% endblock javascript %}
{% block content %}
  <header class="mb-6">
    <h1 class="block text-2xl font-bold text-gray-800 sm:text-3xl dark:text-white">
      {% trans "Vos Cartes" %}
      - {{ total_count }}
    </h1>
    <p class="mt-2 text-lg text-gray-800 dark:text-gray-400">
      {% blocktrans %} Toutes vos cartes de révisions, vous
            pouvez cliquer sur une carte pour voir la réponses associé.
            Toute les nouvelles carte commence avec le niveau difficile pour qu'elle soit evaluer des la prochaine
            revision,
            mais vous avez la possibilite de la mettre au niveau de votre choix (ce qui n'est pas
            recommander){% endblocktrans %}
    </p>
    <div class="flex flex-col gap-2 items-center mt-5 sm:flex-row sm:gap-3">
      <a href="{% url 'flashcards:create' %}"
         class="inline-flex gap-x-3 justify-center items-center py-3 px-4 w-full text-sm font-medium text-center text-white bg-blue-600 rounded-md border border-transparent transition sm:w-auto hover:bg-blue-700 focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 focus:ring-offset-white focus:outline-none dark:focus:ring-offset-gray-800">
        {% heroicon_outline "plus" width="16" height="16" %}
        {% translate "Nouvelle carte(s)" %}
      </a>
    </div>
  </header>
  <form hx-get="."
        hx-indicator=".htmx-indicator"
        hx-target="#flashcards"
        hx-trigger="keyup delay:500ms, change, search"
        hx-swap="innerHTML transition:true"
        class="flex flex-col gap-2 my-5 xl:flex-row"
        id="filter-form">
    {{ form }}
    <button hx-get="{% url 'gifts:set_recipient' %}"
            hx-target="#dialog-form"
            hx-include="[id='filter-form']"
            data-open-modal
            class="inline-flex gap-2 justify-center items-center py-3 px-4 text-sm font-semibold text-white bg-gray-500 rounded-md border border-transparent transition-all dark:bg-gray-700 hover:bg-gray-600 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:outline-none dark:hover:bg-gray-600 dark:focus:ring-offset-gray-800">
      Envoyer a un ami
      {% heroicon_solid "paper-airplane" class="w-4 h-4" %}
    </button>
  </form>
  <div id="flashcards">
    {% partialdef flashcards inline=True %}
    <div class="grid relative grid-cols-1 gap-4 sm:gap-6 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4">
      {% for flashcard in page_obj %}
        {% partialdef card_question inline=True %}
        <div id="flashcard-{{ flashcard.id }}"
             class="flex flex-col justify-between p-4 py-4 px-8 max-w-2xl bg-white rounded-md border shadow-sm md:p-5 dark:bg-gray-800 dark:border-gray-700 dark:shadow-slate-700/[.7]">
          <div class="flex justify-between items-center">
            <span class="text-sm font-light text-gray-600 dark:text-gray-400">{{ flashcard.topic|default:"" }}</span>
            <span {% if flashcard.difficulty == 'HARD' %} class="py-1 px-3 text-sm font-bold text-white bg-red-500 rounded" {% elif flashcard.difficulty == 'MEDIUM' %} class="py-1 px-3 text-sm font-bold text-white bg-yellow-500 rounded" {% else %} class="py-1 px-3 text-sm font-bold text-white bg-green-500 rounded" {% endif %}
                  tabindex="0"
                  role="button">{{ flashcard.get_difficulty_display }}</span>
          </div>
          <div class="mt-2">
            <p hx-get="{% url 'flashcards:show_answer' flashcard.pk %}"
               hx-target="#flashcard-{{ flashcard.pk }}"
               hx-swap="outerHTML "
               class="mt-2 text-gray-800 cursor-pointer dark:text-gray-400">{{ flashcard }}</p>
          </div>
          <div class="flex justify-between items-center mt-4">
            {% if flashcard.next_review_date %}
              <p class="text-gray-500 dark:text-gray-500 text-md">{{ flashcard.next_review_date|naturalday }}</p>
            {% else %}
              <p class="text-gray-500 dark:text-gray-500 text-md">{% trans "Prochaine révision" %}</p>
            {% endif %}
            <a href="{% url 'flashcards:edit' flashcard.pk %}"
               class="inline-flex gap-2 justify-center items-center px-4 text-sm font-semibold text-blue-500 rounded-md border-2 border-gray-200 transition-all dark:border-gray-700 hover:text-white hover:bg-blue-500 hover:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none py-[.688rem] dark:hover:border-blue-500">
              {% trans "Édité" %}
              {% heroicon_outline "pencil" width="15" height="15" %}
            </a>
          </div>
        </div>
      {% endpartialdef card_question %}
    {% endfor %}
    <div class="absolute top-0 left-0 w-full h-full rounded-md htmx-indicator bg-white/[.5] dark:bg-gray-800/[.4]"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 htmx-indicator">
      <div class="inline-block w-6 h-6 text-blue-600 rounded-full border-current animate-spin border-[3px] border-t-transparent"
           role="status"
           aria-label="loading">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
  </div>
  <div class="grid gap-3 py-4 px-6 mt-5 md:flex md:justify-between md:items-center">
    <div class="">
      <p class="text-sm text-gray-600 dark:text-gray-400">
        <span class="font-semibold text-gray-800 dark:text-gray-200">{{ page_obj|length }}</span> {% trans "résultats sur" %}
        <span class="font-semibold text-gray-800 dark:text-gray-200">{{ page_obj.paginator.count }}</span>
      </p>
    </div>
    <div>
      <div class="inline-flex gap-x-2">
        {% if page_obj.has_previous %}
          <a href="{% url 'flashcards:index' %}?page={{ page_obj.previous_page_number }}"
             class="inline-flex gap-2 justify-center items-center py-2 px-3 text-sm font-medium text-gray-700 align-middle bg-white rounded-md border shadow-sm transition-all dark:text-gray-400 dark:border-gray-700 hover:bg-gray-50 focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 focus:ring-offset-white focus:outline-none dark:bg-slate-900 dark:hover:bg-slate-800 dark:hover:text-white dark:focus:ring-offset-gray-800">
            <svg class="w-3 h-3"
                 width="16"
                 height="16"
                 viewBox="0 0 16 15"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg">
              <path d="M10.506 1.64001L4.85953 7.28646C4.66427 7.48172 4.66427 7.79831 4.85953 7.99357L10.506 13.64" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
            Prev
          </a>
        {% endif %}
        {% if page_obj.has_next %}
          <a href="{% url 'flashcards:index' %}?page={{ page_obj.next_page_number }}"
             class="inline-flex gap-2 justify-center items-center py-2 px-3 text-sm font-medium text-gray-700 align-middle bg-white rounded-md border shadow-sm transition-all dark:text-gray-400 dark:border-gray-700 hover:bg-gray-50 focus:ring-2 focus:ring-blue-600 focus:ring-offset-2 focus:ring-offset-white focus:outline-none dark:bg-slate-900 dark:hover:bg-slate-800 dark:hover:text-white dark:focus:ring-offset-gray-800">
            Next
            <svg class="w-3 h-3"
                 width="16"
                 height="16"
                 viewBox="0 0 16 16"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg">
              <path d="M4.50598 2L10.1524 7.64645C10.3477 7.84171 10.3477 8.15829 10.1524 8.35355L4.50598 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </a>
        {% endif %}
      </div>
    </div>
  </div>
{% endpartialdef flashcards %}
</div>
{% endblock content %}
